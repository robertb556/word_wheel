'use strict';

//##############################################
//-----------------UTILITIES--------------------
//##############################################
var LAST_ID = 0;
function getNextId(){
	return LAST_ID++;
}

function clamp(value, min, max){
	if(value < min) value = min;
	if(value > max) value = max;
	return value;
}

//useful for animation
function lerp(start, end, percent){
	return start + percent * (end - start);
}

//Very resource intensive, don't call this every frame.
//Use to initilize graphics you will reuse.
function colorizedImage(base, top, color){
	var canvas = document.createElement("canvas");
	canvas.width = ASSET_SIZE;
	canvas.height = ASSET_SIZE;
	var ctx = canvas.getContext('2d');
	
	ctx.drawImage(base, 0, 0);
	
	ctx.globalCompositeOperation = "source-atop";
	//ctx.globalAlpha = 1;
	ctx.fillStyle = color;
	ctx.fillRect(0, 0, ASSET_SIZE, ASSET_SIZE);
	
	ctx.globalCompositeOperation = "source-over";
	//ctx.globalAlpha = 1;
	ctx.drawImage(top, 0, 0);

	return canvas;
}

//##############################################
//-----------------RANDOM-----------------------
//A random that can stay in sync across multiple clients, for multiplayer.
//##############################################
var Random = function(){
	var me = {};

	me.current = 0;
	me.set = [179,793,218,31,23,456,311,490,613,433,973,520,571,551,358,535,867,833,662,431,596,202,474,458,522,165,664,988,160,226,89,483,620,849,261,554,353,938,476,832,544,642,191,688,824,253,416,604,319,386,247,139,220,826,395,724,895,123,971,465,413,945,818,803,830,964,411,733,745,172,290,128,789,855,570,944,390,316,28,384,717,325,132,109,891,170,64,320,954,205,950,38,430,71,166,277,471,59,713,35,873,20,690,559,580,947,835,685,454,25,157,653,588,418,589,40,92,786,187,427,178,703,336,934,775,95,161,638,542,974,887,462,994,54,432,241,732,385,301,45,548,852,645,675,137,369,204,423,665,997,482,87,545,198,553,440,712,763,321,530,252,942,99,748,879,405,538,910,292,240,174,674,379,82,258,281,896,984,693,518,697,550,569,858,658,619,326,136,564,839,112,420,8,455,242,609,593,761,4,278,478,122,72,102,467,357,698,799,298,362,981,823,225,632,532,272,268,875,90,856,79,622,526,922,44,328,495,939,680,291,150,776,582,363,890,621,546,410,739,183,239,515,834,340,307,373,774,756,598,236,506,195,152,611,949,880,453,637,297,394,407,788,396,214,347,234,599,280,43,333,800,640,841,497,752,878,118,207,669,983,969,254,81,323,436,308,929,533,726,341,303,60,574,935,371,360,715,153,618,711,881,445,899,646,302,561,134,967,581,249,567,966,83,813,52,65,246,918,155,773,528,197,342,784,627,67,936,417,267,176,705,628,999,982,507,349,295,916,897,737,107,412,217,700,914,332,193,269,26,555,88,317,49,211,537,847,91,30,901,509,909,503,74,424,167,283,679,540,859,757,601,182,368,797,908,345,402,767,884,892,145,725,354,747,256,374,704,243,119,330,843,306,913,141,169,719,84,557,977,953,923,469,676,699,792,199,312,470,898,387,69,765,750,422,811,568,720,437,577,189,106,933,421,790,608,722,753,477,941,822,435,12,113,911,403,597,159,714,972,863,388,659,114,70,7,17,286,746,457,231,893,229,998,493,968,694,124,264,116,549,16,605,634,376,845,527,444,976,864,356,958,920,655,639,313,133,869,146,479,117,866,296,986,721,673,192,96,876,484,212,743,275,848,798,882,749,741,667,626,585,815,222,692,517,450,409,56,158,51,727,657,647,706,556,654,232,631,475,534,821,989,151,961,594,149,838,310,817,931,203,227,959,21,100,575,770,223,121,11,245,322,682,842,164,447,441,906,904,276,932,668,573,287,728,740,552,791,62,760,780,529,115,34,943,230,98,802,331,677,915,782,186,271,75,127,523,691,487,257,591,781,104,854,361,224,94,185,787,738,874,541,616,635,917,758,135,346,524,329,656,85,282,868,190,338,820,55,560,244,723,324,606,221,785,927,807,600,736,473,587,812,900,68,508,709,995,586,372,504,57,766,274,201,406,853,213,238,623,289,755,816,108,46,975,144,370,514,334,446,284,263,940,865,809,194,97,41,952,175,771,196,47,825,602,576,250,63,492,889,42,513,672,442,131,990,393,806,318,300,391,359,173,378,686,461,270,729,888,398,836,499,397,572,216,783,562,105,142,399,814,429,985,525,375,337,120,259,154,903,404,32,367,61,39,955,735,759,262,163,168,603,80,53,466,536,846,315,355,649,143,660,615,248,15,426,237,2,464,383,335,731,539,769,344,861,19,77,804,401,486,130,993,5,930,279,37,978,636,885,14,452,491,140,219,366,181,592,617,579,641,171,543,425,850,463,742,489,200,919,76,58,937,762,777,651,448,419,111,928,235,511,377,871,970,801,228,1,837,126,382,468,177,991,744,902,926,614,583,987,209,648,339,501,488,27,304,428,578,460,521,563,438,496,519,754,494,500,684,273,772,365,516,590,314,472,36,630,877,260,624,795,979,584,408,343,963,558,3,607,148,86,288,857,718,924,265,643,18,661,206,215,156,101,794,894,480,828,708,921,681,883,595,957,827,644,687,779,996,481,389,960,251,180,912,829,10,629,565,348,808,689,210,125,50,414,29,810,9,103,650,566,905,451,633,701,208,510,327,48,434,351,502,702,956,73,671,443,768,459,147,33,652,948,962,381,547,796,498,751,380,670,485,844,415,805,449,309,531,683,778,663,831,22,764,512,965,266,188,710,730,840,392,951,870,285,110,184,138,293,992,66,129,93,162,707,24,78,907,610,851,233,364,13,886,505,352,612,946,819,696,625,294,716,6,860,695,925,305,980,862,255,350,439,400,872,678,299,666,734];
	
	me.next1000 = function(){
		var value = me.set[me.current];
		me.current++;
		if(me.current >= me.set.length) me.current = 0;
		return value;
	};

	me.setSeed = function(seed){
		me.current = seed % (me.set.length-1);
	};

	return me;
};

